<!DOCTYPE html>
<html lang="es" data-theme="dark">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard | Gesti贸n de Fletes</title>

    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;800&display=swap" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/remixicon@3.5.0/fonts/remixicon.css" rel="stylesheet">

    <!--  Librer铆as Externas (Deferred for Performance) -->
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js" defer></script>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11" defer></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js" defer></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js" defer></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.31/jspdf.plugin.autotable.min.js"
        defer></script>

    <link rel="stylesheet" href="../css/styles.css">

    <!-- PWA Meta Tags -->
    <meta name="theme-color" content="#3b82f6">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="Fletes App">
    <link rel="apple-touch-icon" href="../assets/img/pwa_logo.png?v=3">
    <link rel="icon" type="image/png" href="../assets/img/pwa_logo.png?v=3">
    <link rel="manifest" href="../manifest.json?v=3">

    <script>
        let deferredPrompt;
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                navigator.serviceWorker.register('../sw.js')
                    .then(reg => console.log('Service Worker registrado', reg))
                    .catch(err => console.error('Error al registrar Service Worker', err));
            });
        }

        // Manejar el evento de instalaci贸n
        window.addEventListener('beforeinstallprompt', (e) => {
            e.preventDefault();
            deferredPrompt = e;
            const btnInstalar = document.getElementById('btnInstalarPWA');
            if (btnInstalar) {
                btnInstalar.style.display = 'block';
                btnInstalar.addEventListener('click', async () => {
                    btnInstalar.style.display = 'none';
                    deferredPrompt.prompt();
                    const { outcome } = await deferredPrompt.userChoice;
                    console.log(`Usuario eligi贸 instalar: ${outcome}`);
                    deferredPrompt = null;
                });
            }
        });
    </script>

    <script src="../js/supabase-client.js"></script>
    <script src="../js/app.js" defer></script>
</head>

<body>

    <!--  SIDEBAR (Navegaci贸n) -->
    <aside class="sidebar glass-sidebar">
        <div class="logo-container">
            <img src="../assets/img/logo_tym.png" alt="Logo Empresa" class="logo-img">
            <h2 class="brand-name">FletesApp</h2>
        </div>

        <nav class="nav-links">
            <a class="nav-item active" data-tab="inicio">
                <i class="ri-dashboard-3-line"></i> Dashboard
            </a>
            <!-- Tab para Admin (Gesti贸n Completa) y Operario (Solo Lectura) -->
            <a class="nav-item" data-tab="fletes" id="navFletes">
                <i class="ri-file-list-3-line"></i> Listado Fletes
            </a>
            <!-- Tab Exclusiva Operario -->
            <a class="nav-item" data-tab="operario-vehiculos" id="navVehiculos" style="display: none;">
                <i class="ri-roadster-line"></i>Veh铆culos
            </a>
            <!-- Tab Exclusiva Admin -->
            <a class="nav-item" data-tab="admin-crear" id="navCrearFlete">
                <i class="ri-add-circle-line"></i> Crear Flete
            </a>

        </nav>

        <div class="sidebar-footer">
            <!-- Export buttons remain here -->
            <div class="actions" style="display: flex; flex-direction: column; align-items: center; gap: 12px;">
                <p style="font-size: 0.75rem; color: var(--text-muted); margin: 0; text-align: center;"> Descargar
                    Reportes</p>
                <div style="display: flex; gap: 10px; justify-content: center; width: 100%;">
                    <button id="btnExportarExcel" onclick="exportarExcel()" class="action-btn" title="Exportar Excel">
                        <i class="ri-file-excel-2-line"></i>
                    </button>
                    <button id="btnExportarPDF" onclick="generarPDF()" class="action-btn" title="Generar PDF">
                        <i class="ri-file-pdf-2-line"></i>
                    </button>
                </div>
            </div>
            <!-- Theme switch remains -->
            <div class="theme-switch-wrapper">
                <label class="theme-switch" for="themeToggle">
                    <input type="checkbox" id="themeToggle" />
                    <div class="slider round">
                        <i class="ri-sun-line sun-icon"></i>
                        <i class="ri-moon-line moon-icon"></i>
                    </div>
                </label>
            </div>
            <button class="logout-btn" onclick="logout()"
                style="width: 100%; border: none; cursor: pointer; background: transparent;">
                <i class="ri-logout-box-r-line"></i> Salir
            </button>
            <!-- Bot贸n de instalaci贸n PWA -->
            <button id="btnInstalarPWA" class="btn"
                style="display: none; width: 100%; margin-top: 15px; background: #22c55e; color: white;">
                <i class="ri-download-2-line"></i> Instalar App
            </button>
        </div>
    </aside>

    <!--  MAIN CONTENT -->
    <main class="main-content">
        <!-- TOPBAR -->
        <header class="topbar glass-header">
            <button id="menuToggleBtn" class="menu-btn"><i class="ri-menu-2-line"></i></button>
            <h1 id="pageTitle">CONTROL DE FLETES</h1>
            <div class="user-profile">
                <span class="badge" id="companyBadge" style="margin-right: 8px;">TYM</span>
                <span class="badge" id="userRoleBadge">Admin</span>
                <div class="avatar">
                    <i class="ri-user-3-line"></i>
                </div>
            </div>
        </header>

        <!--  SECCIN INICIO -->
        <section id="inicio" class="tab-content fade-in">


            <div class="kpi-grid">
                <div class="card glass-card kpi-card">
                    <div class="kpi-icon icon-blue"><i class="ri-truck-line"></i></div>
                    <div class="kpi-info">
                        <h3>Total Fletes</h3>
                        <p id="cantFletes" class="kpi-value">0</p>
                    </div>
                </div>
                <div class="card glass-card kpi-card">
                    <div class="kpi-icon icon-green"><i class="ri-money-dollar-circle-line"></i></div>
                    <div class="kpi-info">
                        <h3>Registros del Mes</h3>
                        <p id="kpiRegistros" class="kpi-value">$ 0</p>
                    </div>
                </div>
                <div class="card glass-card kpi-card">
                    <div class="kpi-icon icon-orange"><i class="ri-steering-2-line"></i></div>
                    <div class="kpi-info">
                        <h3>Veh铆culos Activos</h3>
                        <p id="kpiVehiculos" class="kpi-value">0</p>
                    </div>
                </div>
            </div>

            <!--  SECCIN ESTADSTICAS INTEGRADAS -->
            <div class="grid-2" style="margin-top: 20px;">
                <div class="card glass-card chart-container">
                    <h3>Registros por D铆a</h3>
                    <div class="chart-wrapper">
                        <canvas id="chartRegistros"></canvas>
                    </div>
                </div>
                <div class="card glass-card chart-container">
                    <h3>Fletes por Zona</h3>
                    <div class="chart-wrapper">
                        <canvas id="chartZonas"></canvas>
                    </div>
                </div>
            </div>
        </section>

        <!--  SECCIN EXCLUSIVA CAJA -->
        <section id="caja-view" class="tab-content fade-in"
            style="display: none; min-height: 100vh; background: linear-gradient(135deg, #1e293b 0%, #0f172a 50%, #1e293b 100%); position: relative; overflow: hidden;">

            <!-- Elementos decorativos de fondo -->
            <div
                style="position: absolute; top: 0; left: 0; width: 100%; height: 100%; pointer-events: none; overflow: hidden;">
                <div
                    style="position: absolute; top: -50px; right: -50px; width: 300px; height: 300px; background: radial-gradient(circle, rgba(249, 115, 22, 0.15) 0%, transparent 70%); border-radius: 50%;">
                </div>
                <div
                    style="position: absolute; bottom: -100px; left: -100px; width: 400px; height: 400px; background: radial-gradient(circle, rgba(59, 130, 246, 0.1) 0%, transparent 70%); border-radius: 50%;">
                </div>
            </div>

            <!-- Caja Header -->
            <div
                style="width: 100%; display: flex; justify-content: space-between; align-items: center; padding: 20px 40px; background: rgba(30, 41, 59, 0.8); backdrop-filter: blur(20px); border-bottom: 1px solid rgba(255,255,255,0.1); position: absolute; top: 0; left: 0; z-index: 10; box-shadow: 0 4px 6px rgba(0,0,0,0.1);">
                <div style="display: flex; align-items: center; gap: 15px;">
                    <h2 style="font-size: 1.3rem; margin: 0; color: #fff; font-weight: 700; letter-spacing: 0.5px;">
                        CONTROL DE FLETES</h2>
                    <span class="badge"
                        style="background: linear-gradient(135deg, rgba(249, 115, 22, 0.2) 0%, rgba(249, 115, 22, 0.1) 100%); color: #fb923c; border: 1px solid rgba(249, 115, 22, 0.4); padding: 6px 14px; font-weight: 600; box-shadow: 0 2px 8px rgba(249, 115, 22, 0.2);">CAJA</span>
                </div>
                <div style="display: flex; align-items: center; gap: 15px;">
                    <span style="font-size: 0.95rem; font-weight: 600; color: #fff;">Caja Principal</span>
                    <button onclick="logout()"
                        style="background: linear-gradient(135deg, rgba(239, 68, 68, 0.15) 0%, rgba(239, 68, 68, 0.05) 100%); color: #ef4444; border: 1px solid rgba(239, 68, 68, 0.3); padding: 10px 16px; border-radius: 10px; cursor: pointer; transition: all 0.3s; font-weight: 600; box-shadow: 0 2px 8px rgba(239, 68, 68, 0.15);"
                        onmouseover="this.style.background='linear-gradient(135deg, rgba(239, 68, 68, 0.25) 0%, rgba(239, 68, 68, 0.15) 100%)'; this.style.transform='translateY(-2px)'; this.style.boxShadow='0 4px 12px rgba(239, 68, 68, 0.25)'"
                        onmouseout="this.style.background='linear-gradient(135deg, rgba(239, 68, 68, 0.15) 0%, rgba(239, 68, 68, 0.05) 100%)'; this.style.transform='translateY(0)'; this.style.boxShadow='0 2px 8px rgba(239, 68, 68, 0.15)'">
                        <i class="ri-logout-box-r-line" style="margin-right: 6px;"></i>Salir
                    </button>
                </div>
            </div>

            <!-- Central Card Mejorado -->
            <div
                style="display: flex; align-items: center; justify-content: center; min-height: 100vh; padding: 100px 20px 20px;">
                <div class="card glass-card"
                    style="max-width: 550px; width: 100%; padding: 50px 40px; text-align: center; background: rgba(30, 41, 59, 0.6); backdrop-filter: blur(20px); border: 1px solid rgba(255,255,255,0.1); box-shadow: 0 20px 60px rgba(0,0,0,0.4); position: relative; overflow: hidden;">

                    <!-- Efecto de brillo superior -->
                    <div
                        style="position: absolute; top: 0; left: 0; right: 0; height: 1px; background: linear-gradient(90deg, transparent, rgba(249, 115, 22, 0.6), transparent);">
                    </div>

                    <!-- Icono con animaci贸n -->
                    <div
                        style="font-size: 4rem; color: #f97316; margin-bottom: 25px; filter: drop-shadow(0 0 20px rgba(249, 115, 22, 0.4)); animation: pulse 2s ease-in-out infinite;">
                        <i class="ri-printer-cloud-line"></i>
                    </div>

                    <h1
                        style="font-size: 2.2rem; margin-bottom: 12px; background: linear-gradient(135deg, #fff 0%, #e2e8f0 100%); -webkit-background-clip: text; -webkit-text-fill-color: transparent; background-clip: text; font-weight: 800;">
                        Centro de Impresi贸n</h1>

                    <p style="color: #94a3b8; margin-bottom: 40px; font-size: 1.05rem; line-height: 1.6;">
                        Bienvenido al sistema de reportes.<br>Genera tus informes de planilla de forma r谩pida y
                        sencilla.
                    </p>

                    <!-- Bot贸n mejorado -->
                    <div style="display: grid; gap: 20px;">
                        <button onclick="generarPDF()" class="btn-primary"
                            style="padding: 22px 30px; font-size: 1.15rem; display: flex; align-items: center; justify-content: center; gap: 15px; background: linear-gradient(135deg, #f97316 0%, #ea580c 100%); border: none; box-shadow: 0 8px 24px rgba(249, 115, 22, 0.4); transition: all 0.3s; position: relative; overflow: hidden; font-weight: 600;"
                            onmouseover="this.style.transform='translateY(-3px)'; this.style.boxShadow='0 12px 32px rgba(249, 115, 22, 0.5)'"
                            onmouseout="this.style.transform='translateY(0)'; this.style.boxShadow='0 8px 24px rgba(249, 115, 22, 0.4)'">
                            <i class="ri-file-pdf-2-line" style="font-size: 1.5rem;"></i>
                            <span>Descargar Informe de Planilla</span>
                        </button>
                    </div>

                    <!-- Informaci贸n adicional -->
                    <div style="margin-top: 35px; padding-top: 25px; border-top: 1px solid rgba(255,255,255,0.1);">
                        <p
                            style="font-size: 0.85rem; color: #64748b; display: flex; align-items: center; justify-content: center; gap: 8px;">
                            <i class="ri-information-line"></i>
                            Los reportes se generan en formato PDF
                        </p>
                    </div>
                </div>
            </div>

            <!-- Estilo para animaci贸n de pulso -->
            <style>
                @keyframes pulse {

                    0%,
                    100% {
                        transform: scale(1);
                    }

                    50% {
                        transform: scale(1.05);
                    }
                }
            </style>
        </section>

        <!--  SECCIN CREAR FLETE (ADMIN) -->
        <section id="admin-crear" class="tab-content fade-in">
            <div id="card-admin" class="card glass-card">
                <div class="card-header">
                    <h2><i class="ri-add-circle-line"></i> Registrar Nuevo Flete</h2>
                </div>
                <div class="card-body">
                    <div class="form-grid">
                        <div class="input-group">
                            <label>Placa Veh铆culo</label>
                            <input id="placa" placeholder="EJ: ABC123"
                                oninput="this.value = this.value.toUpperCase().replace('-', '')">
                        </div>
                        <div class="input-group">
                            <label>Conductor (Auto)</label>
                            <input id="contratista" placeholder="Nombre Conductor" readonly class="input-readonly">
                        </div>

                        <div class="input-group">
                            <label>Proveedor</label>
                            <select id="proveedor" onchange="actualizarZonasPorProveedor()">
                                <option value="" disabled selected>Seleccione...</option>
                                <option>ALPINA</option>
                                <option>ZENU</option>
                                <option>FLEISCHMANN</option>
                                <option>ALPINA-FLEISCHMANN</option>
                            </select>
                        </div>

                        <div class="input-group">
                            <label>Zona (Selecci贸n M煤ltiple)</label>
                            <div id="zona-container" class="select-checkbox-container">
                                <div style="padding: 10px; color: #666;">Seleccione Proveedor primero</div>
                            </div>
                        </div>

                        <div class="input-group" style="display: none;">
                            <label>D铆a</label>
                            <select id="dia">
                                <option value="" disabled selected>Seleccione...</option>
                                <option>Lunes</option>
                                <option>Martes</option>
                                <option>Miercoles</option>
                                <option>Jueves</option>
                                <option>Viernes</option>
                                <option>Sabado</option>
                            </select>
                        </div>

                        <div class="input-group">
                            <label>Poblaci贸n</label>
                            <select id="poblacion">
                                <option value="" disabled selected>Seleccione...</option>
                                <option>AGUADAS</option>
                                <option>AGUADAS-PACORA</option>
                                <option>AGUILA-ANSERMA NUEVO</option>
                                <option>ALCALA ULLOA</option>
                                <option>ANSERMA</option>
                                <option>ANSERMA NUEVO</option>
                                <option>APIA- PUEBLO RICO</option>
                                <option>ARABIA - ALTAGRACIA</option>
                                <option>ARANZAZU FILADELFIA</option>
                                <option>ARGELIA EL CAIRO</option>
                                <option>ARGELIA-EL CAIRO</option>
                                <option>ARMENIA</option>
                                <option>BALBOA LA CELIA</option>
                                <option>BELAL RDA SJOSE</option>
                                <option>BELEN</option>
                                <option>BELEN MISTRATO</option>
                                <option>CAICEDONIA</option>
                                <option>CAIMO BARCELONA</option>
                                <option>CALARCA</option>
                                <option>CARTAGO</option>
                                <option>CHINCHINA</option>
                                <option>CIRCASIA</option>
                                <option>CORDOBA PIJAO BVISTA</option>
                                <option>CUBA</option>
                                <option>DOSQUEBRADAS</option>
                                <option>EL AGUILA</option>
                                <option>EL AGUILA - VILLANUEVA</option>
                                <option>FILANDIA</option>
                                <option>GENOVA</option>
                                <option>GUATICA</option>
                                <option>IRRA LA FELISA LA MERCED</option>
                                <option>LA VIRGINIA</option>
                                <option>LA VIRGINA -BELALCAZAR</option>
                                <option>MANIZALES</option>
                                <option>MANIZALES - VILLAMARIA</option>
                                <option>MANIZALES-DESDE PEREIRA-CARGA EXTRA</option>
                                <option>MARMATO</option>
                                <option>MARSELLA</option>
                                <option>MISTRATO</option>
                                <option>MONTENEGRO</option>
                                <option>MONTENEGRO - P TAPAO</option>
                                <option>NEIRA</option>
                                <option>PACORA</option>
                                <option>PALESTINA ARAUCA LA PLATA</option>
                                <option>PEREIRA</option>
                                <option>PUEBLO RICO</option>
                                <option>QUIMBAYA</option>
                                <option>QUINCHIA</option>
                                <option>RIOSUCIO</option>
                                <option>SANTA CECILIA</option>
                                <option>SANTA ROSA</option>
                                <option>SANTUARIO</option>
                                <option>SANTUARIO APIA</option>
                                <option>SUPIA</option>
                                <option>SUPIA-MARMATO</option>
                                <option>TEBAIDA</option>
                                <option>VITERBO</option>
                            </select>
                        </div>

                        <div class="input-group">
                            <label>Nombres Auxiliares</label>
                            <input id="auxiliares" type="text" placeholder="Nombre y Apellido"
                                oninput="this.value = this.value.toUpperCase()" required>
                        </div>

                        <div class="input-group">
                            <label>Cant. Auxiliares (M谩x. 2)</label>
                            <select id="no_auxiliares">
                                <option>1</option>
                                <option>2</option>
                            </select>
                        </div>

                        <div class="input-group">
                            <label>No. Pedidos</label>
                            <input id="no_pedidos" type="number" placeholder="0">
                        </div>

                        <div class="input-group">
                            <label>Valor Ruta</label>
                            <input id="valor_ruta" type="text" placeholder="$ 0" class="money-input">
                        </div>

                        <div class="input-group">
                            <label>驴Adicionales?</label>
                            <select id="is_adicionales">
                                <option value="No">No</option>
                                <option value="Si">Si (+ $60.000)</option>
                            </select>
                        </div>

                        <!-- NUEVOS CAMPOS: PLANILLA Y FACTURAS -->
                        <div class="input-group">
                            <label>No. Planilla (Obligatorio)</label>
                            <input id="no_planilla" placeholder="Eje: 1234, 5678" required>
                        </div>

                        <div class="input-group">
                            <label>Facturas Adicionales</label>
                            <input id="facturas_adicionales" placeholder="Facturas extra...">
                        </div>

                        <!-- Adicionales por Negociaci贸n -->
                        <div class="input-group">
                            <label>Adicional Negociado</label>
                            <input id="valor_adicional" type="text" placeholder="$ 0" class="money-input">
                        </div>

                        <div class="input-group full-width">
                            <label>Raz贸n del Adicional</label>
                            <textarea id="razon_adicional" rows="2"
                                placeholder="Ecriba el motivo de la negociaci貌n"></textarea>
                        </div>

                        <div class="input-group">
                            <label>Total Flete (Autom谩tico)</label>
                            <input id="total_flete" type="text" placeholder="$ 0" readonly class="input-total">
                        </div>
                        <div class="input-group">
                            <label>Participaci贸n %</label>
                            <input id="porcentaje_ruta" type="text" placeholder="0%" readonly
                                style="font-weight: bold;">
                        </div>
                    </div>

                    <div class="form-actions">
                        <button id="btnGestionarFlete" class="btn btn-primary btn-glow">
                            <i class="ri-save-3-line"></i> Guardar Flete
                        </button>
                    </div>
                </div>
            </div>
        </section>

        <!--  SECCIN OPERARIO: REGISTRAR VEHCULO -->
        <section id="operario-vehiculos" class="tab-content fade-in">
            <div id="card-operario" class="card glass-card">
                <div class="card-header">
                    <h2><i class="ri-truck-line"></i> Registrar Nuevo Veh铆culo</h2>
                    <p class="text-muted">Ingrese la informaci贸n del veh铆culo para habilitarlo en el sistema.</p>
                </div>
                <div class="card-body">
                    <div class="form-grid">
                        <div class="input-group">
                            <label>Placa Veh铆culo</label>
                            <input id="op_placa" placeholder="EJ: XYZ789"
                                oninput="this.value = this.value.toUpperCase().replace('-', ''); autoFillConductorOperario(this.value)">
                        </div>
                        <div class="input-group">
                            <label>Nombre Conductor</label>
                            <input id="op_conductor" placeholder="Nombre Completo">
                        </div>
                        <div class="input-group">
                            <label>C茅dula Conductor</label>
                            <input id="op_cedula_conductor" placeholder="C.C. No.">
                        </div>
                        <div class="input-group">
                            <label>Tel茅fono Conductor</label>
                            <input id="op_telefono_conductor" placeholder="Celular">
                        </div>
                        <div class="input-group">
                            <label>Modelo del Veh铆culo</label>
                            <input id="op_modelo" placeholder="Ej: Cami贸n Turbo, Van, etc.">
                        </div>
                        <div class="input-group">
                            <label>Carrocer铆a</label>
                            <input id="op_carroceria" placeholder="Tipo de carrocer铆a">
                        </div>
                        <div class="input-group">
                            <label>Capacidad</label>
                            <input id="op_capacidad" placeholder="Capacidad de carga">
                        </div>
                        <div class="input-group">
                            <label>Servicio</label>
                            <input id="op_servicio" placeholder="Tipo de servicio">
                        </div>
                        <div class="input-group">
                            <label>Contrato</label>
                            <select id="op_contrato">
                                <option value="SI" selected>SI</option>
                                <option value="NO">NO</option>
                            </select>
                        </div>
                        <div class="input-group">
                            <label>Nombre Contratista</label>
                            <input id="op_contratista" placeholder="Propietario del Veh铆culo">
                        </div>
                        <div class="input-group">
                            <label>Doc. Contratista</label>
                            <input id="op_doc_contratista" placeholder="C.C. o NIT">
                        </div>
                        <div class="input-group">
                            <label>Titular de Contrato</label>
                            <input id="op_titular_contrato" placeholder="Nombre completo">
                        </div>
                        <div class="input-group">
                            <label>Licencia de Tr谩nsito</label>
                            <input id="op_licencia_transito" placeholder="Datos Licencia">
                        </div>

                        <!-- SECCIN DOCUMENTACIN -->
                        <div
                            style="grid-column: 1 / -1; margin-top: 10px; border-bottom: 1px solid var(--glass-border); padding-bottom: 5px;">
                            <h3 style="font-size: 0.9rem; color: var(--accent-orange);"><i
                                    class="ri-file-info-line"></i> Vencimiento de Documentos</h3>
                        </div>

                        <div class="input-group">
                            <label>SOAT (Vencimiento)</label>
                            <input id="op_soat_vencimiento" type="date">
                        </div>
                        <div class="input-group">
                            <label>Tecnomec谩nica</label>
                            <input id="op_tecnomecanica_vencimiento" type="date">
                        </div>
                        <div class="input-group">
                            <label>Inspecci贸n Sanitaria</label>
                            <input id="op_inspeccion_sanitaria_vencimiento" type="date">
                        </div>
                        <div class="input-group">
                            <label>Fumigaci贸n Vehicular</label>
                            <input id="op_fumigacion_vencimiento" type="date">
                        </div>
                        <div class="input-group">
                            <label>Carnet BPM Conductor</label>
                            <input id="op_carnet_bpm_vencimiento" type="date">
                        </div>
                        <div class="input-group">
                            <label>Licencia Cond. (Venc.)</label>
                            <input id="op_licencia_conduccion_vencimiento" type="date">
                        </div>
                        <div class="input-group">
                            <label>No. Licencia Cond.</label>
                            <input id="op_num_licencia_conduccion" placeholder="No. Licencia">
                        </div>
                        <div class="input-group">
                            <label>Afiliaci贸n ARL</label>
                            <input id="op_arl_afiliacion" placeholder="Empresa/Estado">
                        </div>
                        <div class="input-group">
                            <label>Ex谩menes M茅dicos</label>
                            <input id="op_examenes_medicos_vencimiento" type="date">
                        </div>
                        <div class="input-group">
                            <label>Afiliaci贸n EPS</label>
                            <input id="op_eps_afiliacion" placeholder="Empresa EPS">
                        </div>
                    </div>
                    <div class="form-actions" style="gap: 10px; flex-wrap: wrap;">
                        <button id="btnRegistrarVehiculo" class="btn"
                            style="background: transparent; border: 1px solid #22c55e; color: #22c55e; font-weight: 600; padding: 10px 24px; transition: all 0.3s; box-shadow: 0 0 10px rgba(34, 197, 94, 0.05);"
                            onmouseover="this.style.background='rgba(34, 197, 94, 0.08)'; this.style.boxShadow='0 0 15px rgba(34, 197, 94, 0.2)'"
                            onmouseout="this.style.background='transparent'; this.style.boxShadow='0 0 10px rgba(34, 197, 94, 0.05)'">
                            <i class="ri-user-add-line" style="margin-right: 8px;"></i> Registrar Conductor
                        </button>
                    </div>
                </div>

                <!-- Lista de Flota (Visible para Operario) -->
                <div class="glass-card"
                    style="margin-top:20px; border-top:1px solid var(--glass-border); padding-top:20px">
                    <div class="card-header flex-header">
                        <h2><i class="ri-list-check-2"></i> Flota Registrada</h2>
                        <div class="filters" style="display: flex; gap: 10px; align-items: center;">
                            <input id="buscarVehiculo" placeholder="Buscar placa, conductor o contratista..."
                                onkeyup="buscarVehiculosDebounced()" style="flex: 1;">
                            <button id="btnExportarVehiculos" onclick="exportarVehiculosExcel()" class="action-btn"
                                title="Exportar Veh铆culos a Excel" style="padding: 8px 12px; height: 42px;">
                                <i class="ri-file-excel-2-line"></i>
                            </button>
                        </div>
                    </div>
                    <div class="table-container">
                        <table>
                            <thead>
                                <tr>
                                    <th>Placa</th>
                                    <th>Carrocer铆a</th>
                                    <th>Capacidad</th>
                                    <th>Servicio</th>
                                    <th>Contrato</th>
                                    <th>Nombre Contratista</th>
                                    <th>Doc. Contratista</th>
                                    <th>Titular Contrato</th>
                                    <th>Lic. Tr谩nsito</th>
                                    <th>Conductor</th>
                                    <th>C茅dula</th>
                                    <th>Tel茅fono</th>
                                    <th>Modelo</th>
                                    <th>SOAT (Venc.)</th>
                                    <th>Tecno (Venc.)</th>
                                    <th>Sanitaria</th>
                                    <th>Fumigaci贸n</th>
                                    <th>BPM</th>
                                    <th>Lic. Conducci贸n</th>
                                    <th>ARL</th>
                                    <th>EPS</th>
                                    <th>Ex. M茅dicos</th>
                                    <th>Estado</th>
                                    <th class="actions-col">Acciones</th>
                                </tr>
                            </thead>
                            <tbody id="tablaVehiculos">
                                <!-- JS Renders Fleet Here -->
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </section>

        <!--  SECCIN LISTADO FLETES (TODOS) -->
        <section id="fletes" class="tab-content fade-in">
            <div class="card glass-card" id="card-listado-fletes">
                <div class="card-header flex-header">
                    <h2><i class="ri-search-eye-line"></i> Base de Datos Fletes</h2>
                    <div class="filters">
                        <input id="buscarFlete" placeholder="Buscar placa, conductor, planilla..."
                            onkeyup="buscarFletes()">
                        <select id="filtroZona" onchange="buscarFletes()">
                            <option value="">Todas las Zonas</option>
                            <option>M9450</option>
                            <option>M9451</option>
                            <option>M9453</option>
                            <option>M9454</option>
                            <option>M9455</option>
                            <option>M9456</option>
                            <option>M9457</option>
                            <option>M9458</option>
                            <option>M9459</option>
                            <option>M9460</option>
                            <option>P7004</option>
                            <option>P7005</option>
                            <option>P7005B</option>
                            <option>P7006</option>
                            <option>P7007</option>
                            <option>P7000</option>
                            <option>P7001</option>
                            <option>P7002</option>
                            <option>M9550</option>
                            <option>M9552</option>
                            <option>M9553</option>
                            <option>M9554</option>
                            <option>M9555</option>
                            <option>M9556</option>
                            <option>M9557</option>
                            <option>M9558</option>
                            <option>M9559</option>
                            <option>M9560</option>
                            <option>M9600</option>
                            <option>M9601</option>
                            <option>M9602</option>
                            <option>M9603</option>
                            <option>M9604</option>
                            <option>M9605</option>
                            <option>M9606</option>
                            <option>P7008</option>
                            <option>P7009</option>
                            <option>P7010</option>
                            <option>25021</option>
                            <option>25022</option>
                            <option>25023</option>
                            <option>25024</option>
                            <option>25025</option>
                            <option>25026</option>
                            <option>25027</option>
                            <option>25028</option>
                            <option>FC01</option>
                            <option>FC02</option>
                            <option>FC03</option>
                            <option>FQ04</option>
                            <option>FQ05</option>
                            <option>FQ06</option>
                            <option>FR07</option>
                            <option>FR08</option>
                            <option>FR09</option>
                        </select>
                        <input type="date" id="filtroFecha" onchange="buscarFletes()">
                    </div>
                </div>

                <div class="table-container">
                    <table>
                        <thead>
                            <tr>
                                <th>Fecha</th>
                                <th>D铆a</th>
                                <th>Proveedor</th>
                                <th>Conductor</th>
                                <th>Placa</th>
                                <th>No. Planilla</th>
                                <th>Zona</th>
                                <th>Poblaci贸n</th>
                                <th>Auxiliares</th>
                                <th>驴Adic?</th>
                                <th>$ Negoc.</th>
                                <th>Motivo</th>
                                <th>Valor Ruta</th>
                                <th>Valor Flete</th>
                                <th class="admin-actions-col" style="display: none;">Acciones</th>
                            </tr>
                        </thead>
                        <tbody id="tablaFletes">
                            <!-- JS Renders Rows Here -->
                        </tbody>
                    </table>
                    <div style="text-align: center; margin-top: 15px; margin-bottom: 10px;">
                        <button id="btnCargarMas" class="btn btn-secondary" onclick="cargarMasFletes()"
                            style="display: none; width: 100%; max-width: 300px;">
                            <i class="ri-loader-2-line"></i> Cargar m谩s antiguos...
                        </button>
                    </div>
                </div>
            </div>
        </section>



    </main>

    <!-- MODAL EDICIN -->
    <div id="modalEdicionFlete" class="modal-overlay">
        <div class="modal-glass">
            <div class="modal-header">
                <h2>锔 Editar Flete <span id="modal-title-info"
                        style="font-size: 0.9rem; margin-left:10px; opacity: 0.8;"></span></h2>
                <button class="close-btn" onclick="ocultarModalEdicion()"><i class="ri-close-line"></i></button>
            </div>

            <div class="modal-body">
                <style>
                    .modal-section-title {
                        grid-column: 1 / -1;
                        padding: 10px 0;
                        margin-top: 10px;
                        border-bottom: 1px solid rgba(255, 255, 255, 0.1);
                        color: var(--accent-orange);
                        font-size: 0.85rem;
                        font-weight: 700;
                        text-transform: uppercase;
                        letter-spacing: 1px;
                        display: flex;
                        align-items: center;
                        gap: 8px;
                    }

                    .modal-section-title i {
                        font-size: 1.1rem;
                    }
                </style>
                <div class="form-grid">
                    <div class="modal-section-title"><i class="ri-information-line"></i> Informaci贸n General</div>
                    <!-- Mismos campos con prefijo modal- -->
                    <div class="input-group"> <label>Fecha</label> <input id="modal-fecha" type="date"> </div>
                    <div class="input-group"> <label>Placa</label> <input id="modal-placa"
                            oninput="this.value = this.value.toUpperCase().replace('-', '')"> </div>
                    <div class="input-group"> <label>Conductor</label> <input id="modal-contratista" readonly
                            class="input-readonly"> </div>
                    <div class="input-group">
                        <label>Proveedor</label>
                        <select id="modal-proveedor" onchange="actualizarZonasPorProveedor('modal-')">
                            <option value="" disabled selected>Seleccione...</option>
                            <option>ALPINA</option>
                            <option>ZENU</option>
                            <option>FLEISCHMANN</option>
                            <option>ALPINA-FLEISCHMANN</option>
                        </select>
                    </div>

                    <div class="modal-section-title"><i class="ri-map-pin-line"></i> Ruta y Ubicaci贸n</div>
                    <div class="input-group" style="grid-column: span 2;">
                        <label>Zona (Selecci贸n M煤ltiple)</label>
                        <div id="modal-zona-container" class="select-checkbox-container" style="max-height: 120px;">
                            <!-- JS Generates Checkboxes Here -->
                        </div>
                    </div>

                    <div class="input-group"> <label>D铆a</label> <select id="modal-dia">
                            <option>Lunes</option>
                            <option>Martes</option>
                            <option>Miercoles</option>
                            <option>Jueves</option>
                            <option>Viernes</option>
                            <option>Sabado</option>
                        </select> </div>

                    <div class="input-group"> <label>Poblaci贸n</label> <select id="modal-poblacion">
                            <!-- JS Fills this -->
                        </select> </div>

                    <div class="modal-section-title"><i class="ri-truck-line"></i> Detalles del Flete</div>
                    <div class="input-group"> <label>Auxiliares</label> <input id="modal-auxiliares" type="text"
                            oninput="this.value = this.value.toUpperCase()"> </div>
                    <div class="input-group"> <label>No. Aux</label> <select id="modal-no_auxiliares">
                            <option>1</option>
                            <option>2</option>
                        </select> </div>
                    <div class="input-group"> <label>No. Pedidos</label> <input id="modal-no_pedidos" type="number">
                    </div>

                    <div class="input-group"> <label>Valor Ruta</label> <input id="modal-valor_ruta" type="text"
                            class="money-input"> </div>

                    <div class="input-group">
                        <label>No. Planilla</label>
                        <input id="modal-no_planilla" placeholder="Eje: 1234, 5678">
                    </div>

                    <div class="input-group">
                        <label>Facturas Adicionales</label>
                        <input id="modal-facturas_adicionales" placeholder="Facturas extra...">
                    </div>

                    <div class="modal-section-title"><i class="ri-coins-line"></i> Extras y Totales</div>
                    <div class="input-group">
                        <label>驴Servicios Adicionales?</label>
                        <select id="modal-is_adicionales">
                            <option value="No">No</option>
                            <option value="Si">Si</option>
                        </select>
                    </div>

                    <div class="input-group"> <label>Adicional Negociado</label> <input id="modal-valor_adicional"
                            type="text" class="money-input" placeholder="$ 0"> </div>

                    <div class="input-group full-width"> <label>Raz贸n del Adicional</label> <textarea
                            id="modal-razon_adicional" rows="1" placeholder="Motivo del adicional"></textarea> </div>

                    <div class="input-group"> <label>Total a Pagar</label> <input id="modal-total_flete" type="text"
                            readonly class="input-total" style="color: var(--accent-orange); font-size: 1.1rem;"> </div>

                    <div class="input-group"> <label>Participaci贸n %</label> <input id="modal-porcentaje_ruta"
                            type="text" readonly style="font-weight: 800; font-size: 1.1rem;"> </div>
                </div>
            </div>

            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="ocultarModalEdicion()">Cancelar</button>
                <button id="btnGuardarModal" class="btn btn-primary">Guardar
                    Cambios</button>
            </div>
        </div>
    </div>

    <!-- MODAL EDICIN VEHCULO -->
    <div id="modalEdicionVehiculo" class="modal-overlay">
        <div class="modal-glass" style="max-width: 500px;">
            <div class="modal-header">
                <h2>锔 Editar Veh铆culo</h2>
                <button class="close-btn" onclick="ocultarModalVehiculo()"><i class="ri-close-line"></i></button>
            </div>

            <div class="modal-body">
                <div class="form-grid">
                    <input type="hidden" id="edit-vehiculo-id">
                    <div class="input-group">
                        <label>Placa</label>
                        <input id="edit-vehiculo-placa" placeholder="EJ: ABC123"
                            oninput="this.value = this.value.toUpperCase().replace('-', '')">
                    </div>
                    <div class="input-group">
                        <label>Conductor</label>
                        <input id="edit-vehiculo-conductor" placeholder="Nombre completo">
                    </div>
                    <div class="input-group">
                        <label>C茅dula Conductor</label>
                        <input id="edit-vehiculo-cedula_conductor" placeholder="C.C. No.">
                    </div>
                    <div class="input-group">
                        <label>Tel茅fono Conductor</label>
                        <input id="edit-vehiculo-telefono_conductor" placeholder="Celular">
                    </div>
                    <div class="input-group">
                        <label>Modelo</label>
                        <input id="edit-vehiculo-modelo" placeholder="Turbo, Sencillo...">
                    </div>
                    <div class="input-group">
                        <label>Carrocer铆a</label>
                        <input id="edit-vehiculo-carroceria" placeholder="Tipo de carrocer铆a">
                    </div>
                    <div class="input-group">
                        <label>Capacidad</label>
                        <input id="edit-vehiculo-capacidad" placeholder="Capacidad de carga">
                    </div>
                    <div class="input-group">
                        <label>Servicio</label>
                        <input id="edit-vehiculo-servicio" placeholder="Tipo de servicio">
                    </div>
                    <div class="input-group">
                        <label>Contrato</label>
                        <select id="edit-vehiculo-contrato">
                            <option value="SI">SI</option>
                            <option value="NO">NO</option>
                        </select>
                    </div>
                    <div class="input-group">
                        <label>Contratista</label>
                        <input id="edit-vehiculo-contratista" placeholder="Empresa/Persona">
                    </div>
                    <div class="input-group">
                        <label>Doc. Contratista</label>
                        <input id="edit-vehiculo-doc_contratista" placeholder="NIT/C.C.">
                    </div>
                    <div class="input-group">
                        <label>Titular Contrato</label>
                        <input id="edit-vehiculo-titular_contrato" placeholder="Nombre completo">
                    </div>
                    <div class="input-group">
                        <label>Licencia Tr谩nsito</label>
                        <input id="edit-vehiculo-licencia_transito" placeholder="Datos licencia">
                    </div>

                    <div class="modal-section-title" style="grid-column: 1 / -1; margin-top: 15px;"><i
                            class="ri-file-list-2-line"></i> Documentaci贸n y Vencimientos</div>

                    <div class="input-group">
                        <label>SOAT (Venc.)</label>
                        <input id="edit-vehiculo-soat_vencimiento" type="date">
                    </div>
                    <div class="input-group">
                        <label>Tecnomec谩nica</label>
                        <input id="edit-vehiculo-tecnomecanica_vencimiento" type="date">
                    </div>
                    <div class="input-group">
                        <label>Insp. Sanitaria</label>
                        <input id="edit-vehiculo-inspeccion_sanitaria_vencimiento" type="date">
                    </div>
                    <div class="input-group">
                        <label>Fumigaci贸n Vehic.</label>
                        <input id="edit-vehiculo-fumigacion_vencimiento" type="date">
                    </div>
                    <div class="input-group">
                        <label>Carnet BPM</label>
                        <input id="edit-vehiculo-carnet_bpm_vencimiento" type="date">
                    </div>
                    <div class="input-group">
                        <label>Licencia Cond. (Venc.)</label>
                        <input id="edit-vehiculo-licencia_conduccion_vencimiento" type="date">
                    </div>
                    <div class="input-group">
                        <label>Num. Licencia Cond.</label>
                        <input id="edit-vehiculo-num_licencia_conduccion" placeholder="No. de Licencia">
                    </div>
                    <div class="input-group">
                        <label>ARL Afiliaci贸n</label>
                        <input id="edit-vehiculo-arl_afiliacion" placeholder="Detalle ARL">
                    </div>
                    <div class="input-group">
                        <label>Ex谩menes M茅dicos</label>
                        <input id="edit-vehiculo-examenes_medicos_vencimiento" type="date">
                    </div>
                    <div class="input-group">
                        <label>EPS Afiliaci贸n</label>
                        <input id="edit-vehiculo-eps_afiliacion" placeholder="Detalle EPS">
                    </div>
                </div>
            </div>

            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="ocultarModalVehiculo()">Cancelar</button>
                <button onclick="guardarCambiosVehiculo()" class="btn btn-primary">Guardar Cambios</button>
            </div>
        </div>
    </div>

    <!-- APP SCRIPTS are loaded in HEAD -->
</body>

</html>