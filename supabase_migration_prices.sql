-- ==========================================================
-- üí∞ MIGRACI√ìN: GESTI√ìN DE PRECIOS DIN√ÅMICA
-- ==========================================================

-- 1. Crear Tabla de Precios
create table if not exists precios_fletes (
    id uuid default gen_random_uuid() primary key,
    lista_id text not null, -- 'GENERAL', 'ALPINA', 'ZENU', 'POLAR', 'TAT_UNILEVER', 'TAT_FAMILIA', 'TAT_BASE'
    poblacion text not null,
    precio numeric not null default 0,
    updated_at timestamp with time zone default now(),
    unique(lista_id, poblacion) -- Evitar duplicados
);

-- 2. Habilitar RLS (Seguridad)
alter table precios_fletes enable row level security;

-- Pol√≠tica: Todos pueden VER los precios (necesario para operarios crear fletes)
create policy "Todos pueden ver precios"
on precios_fletes for select
using (true);

-- Pol√≠tica: Solo ADMIN puede EDITAR/INSERTAR precios
-- (Asumiendo que los admins tienen rol 'admin' en metadata o perfil, 
--  por simplicidad aqu√≠ permitimos update a autenticados, la UI filtra,
--  pero idealmente se restringe por rol en una pol√≠tica m√°s avanzada)
create policy "Admin gestiona precios"
on precios_fletes for all
using (auth.role() = 'authenticated') -- Refinar esto si tienes tabla de perfiles con roles
with check (auth.role() = 'authenticated');


-- 3. INSERTAR DATOS INICIALES (MIGRACI√ìN DESDE APP.JS)

-- LIMPIAR PRIMERO SI YA EXIST√çAN DE PRUEBAS
truncate table precios_fletes;

insert into precios_fletes (lista_id, poblacion, precio) values
-- PRECIOS_POBLACION (GENERAL)
('GENERAL', 'AGUADAS', 690000),
('GENERAL', 'AGUADAS-PACORA', 728000),
('GENERAL', 'AGUILA-ANSERMA NUEVO', 317000),
('GENERAL', 'ALCALA ULLOA', 235000),
('GENERAL', 'ANSERMA', 332000),
('GENERAL', 'ANSERMA NUEVO', 280000),
('GENERAL', 'APIA- PUEBLO RICO', 320000),
('GENERAL', 'ARABIA - ALTAGRACIA', 230000),
('GENERAL', 'ARANZAZU FILADELFIA', 425000),
('GENERAL', 'ARGELIA EL CAIRO', 335000),
('GENERAL', 'ARGELIA-EL CAIRO', 338000),
('GENERAL', 'ARMENIA', 295000),
('GENERAL', 'BALBOA LA CELIA', 350000),
('GENERAL', 'BELAL RDA SJOSE', 320000),
('GENERAL', 'BELEN', 305000),
('GENERAL', 'BELEN MISTRATO', 425000),
('GENERAL', 'CAICEDONIA', 336000),
('GENERAL', 'CAIMO BARCELONA', 315000),
('GENERAL', 'CALARCA', 312000),
('GENERAL', 'CARTAGO', 250000),
('GENERAL', 'CHINCHINA', 250000),
('GENERAL', 'CIRCASIA', 294000),
('GENERAL', 'CORDOBA PIJAO BVISTA', 350000),
('GENERAL', 'CUBA', 200000),
('GENERAL', 'DOSQUEBRADAS', 208000),
('GENERAL', 'EL AGUILA', 305000),
('GENERAL', 'EL AGUILA - VILLANUEVA', 330000),
('GENERAL', 'FILANDIA', 350000),
('GENERAL', 'GENOVA', 385000),
('GENERAL', 'GUATICA', 368000),
('GENERAL', 'IRRA LA FELISA LA MERCED', 445000),
('GENERAL', 'LA VIRGINIA', 230000),
('GENERAL', 'LA VIRGINA -BELALCAZAR', 282000),
('GENERAL', 'MANIZALES', 245000),
('GENERAL', 'MANIZALES - VILLAMARIA', 305000),
('GENERAL', 'MANIZALES-DESDE PEREIRA-CARGA EXTRA', 295000),
('GENERAL', 'MARMATO', 499000),
('GENERAL', 'MARSELLA', 259000),
('GENERAL', 'MISTRATO', 362000),
('GENERAL', 'MONTENEGRO', 260000),
('GENERAL', 'MONTENEGRO - P TAPAO', 275000),
('GENERAL', 'NEIRA', 340000),
('GENERAL', 'PACORA', 670000),
('GENERAL', 'PALESTINA ARAUCA LA PLATA', 280000),
('GENERAL', 'PEREIRA', 208000),
('GENERAL', 'PEREIRA-DOSQUEBRADAS', 230000),
('GENERAL', 'PUEBLO RICO', 305000),
('GENERAL', 'QUIMBAYA', 245000),
('GENERAL', 'QUINCHIA', 439000),
('GENERAL', 'RIOSUCIO', 545000),
('GENERAL', 'SANTA CECILIA', 368000),
('GENERAL', 'SANTA ROSA', 212000),
('GENERAL', 'SANTUARIO', 284000),
('GENERAL', 'SANTUARIO APIA', 284000),
('GENERAL', 'SUPIA', 505000),
('GENERAL', 'SUPIA-MARMATO', 590000),
('GENERAL', 'TEBAIDA', 305000),
('GENERAL', 'VITERBO', 323000),

-- PRECIOS_ALPINA
('ALPINA', 'QUIMBAYA', 260000),
('ALPINA', 'MONTENEGRO', 280000),
('ALPINA', 'MONTENEGRO - P TAPAO', 305000),
('ALPINA', 'ALCALA ULLOA', 260000),
('ALPINA', 'CAICEDONIA', 365000),
('ALPINA', 'TEBAIDA', 310000),
('ALPINA', 'CORDOBA PIJAO BVISTA', 370000),
('ALPINA', 'GENOVA', 399000),
('ALPINA', 'CIRCASIA', 294000),
('ALPINA', 'SALENTO', 285000),
('ALPINA', 'FILANDIA', 350000),
('ALPINA', 'CALARCA', 312000),
('ALPINA', 'CAIMO BARCELONA', 340000),
('ALPINA', 'ARMENIA', 320000),
('ALPINA', 'BALBOA LA CELIA', 284000),
('ALPINA', 'SANTUARIO APIA', 284000),
('ALPINA', 'SANTA CECILIA', 368000),
('ALPINA', 'PUEBLO RICO', 305000),
('ALPINA', 'LA VIRGINIA', 230000),
('ALPINA', 'ARGELIA EL CAIRO', 335000),
('ALPINA', 'EL AGUILA', 305000),
('ALPINA', 'EL AGUILA - VILLANUEVA', 330000),
('ALPINA', 'MARSELLA', 280000),
('ALPINA', 'ARABIA - ALTAGRACIA', 199000),
('ALPINA', 'ANSERMA', 332000),
('ALPINA', 'BELEN', 332000),
('ALPINA', 'MISTRATO', 362000),
('ALPINA', 'GUATICA', 368000),
('ALPINA', 'VITERBO', 273000),
('ALPINA', 'CARTAGO', 250000),
('ALPINA', 'CARTAGO 2T', 280000),
('ALPINA', 'ANSERMA NUEVO', 250000),
('ALPINA', 'ANSERMA NUEVO 2T', 280000),
('ALPINA', 'SANTA ROSA', 230000),
('ALPINA', 'DOSQUEBRADAS', 190000),
('ALPINA', 'PEREIRA', 200000),
('ALPINA', 'PEREIRA-DOSQUEBRADAS', 230000),
('ALPINA', 'CUBA', 200000),
('ALPINA', 'SUPIA', 505000),
('ALPINA', 'RIOSUCIO', 545000),
('ALPINA', 'MARMATO', 499000),
('ALPINA', 'SUPIA-MARMATO', 590000),
('ALPINA', 'QUINCHIA', 439000),
('ALPINA', 'IRRA LA FELISA LA MERCED', 445000),
('ALPINA', 'AGUADAS', 690000),
('ALPINA', 'AGUADAS-PACORA', 740000),
('ALPINA', 'PACORA', 670000),
('ALPINA', 'ARANZAZU FILADELFIA', 425000),
('ALPINA', 'BELAL RDA SJOSE', 320000),
('ALPINA', 'CHINCHINA', 250000),
('ALPINA', 'PALESTINA ARAUCA LA PLATA', 280000),
('ALPINA', 'MANIZALES - VILLAMARIA', 305000),
('ALPINA', 'NEIRA', 340000),

-- PRECIOS_ZENU
('ZENU', 'SANTA ROSA', 212000),
('ZENU', 'CARTAGO', 270000),
('ZENU', 'PEREIRA', 208000),
('ZENU', 'PEREIRA-DOSQUEBRADAS', 230000),
('ZENU', 'DOSQUEBRADAS', 208000),
('ZENU', 'APIA- PUEBLO RICO', 320000),
('ZENU', 'BELEN', 305000),
('ZENU', 'ARGELIA-EL CAIRO', 338000),
('ZENU', 'SANTUARIO', 284000),
('ZENU', 'ARABIA-ALTAGRACIA', 230000),
('ZENU', 'MARSELLA', 259000),
('ZENU', 'BALBOA LA CELIA', 350000),
('ZENU', 'LA VIRGINA -BELALCAZAR', 282000),
('ZENU', 'BELEN MISTRATO', 425000),
('ZENU', 'AGUILA-ANSERMA NUEVO', 317000),
('ZENU', 'VITERBO', 323000),

-- PRECIOS_POLAR
('POLAR', 'ARMENIA', 295000),
('POLAR', 'MANIZALES-DESDE PEREIRA-CARGA EXTRA', 300000),
('POLAR', 'MANIZALES', 205000),
('POLAR', 'PEREIRA-DOSQUEBRADAS', 230000),

-- PRECIOS_TAT_BASE
('TAT_BASE', 'PEREIRA MM CARRO GRANDE', 230000),
('TAT_BASE', 'PEREIRA-DOSQUEBRADAS', 230000),
('TAT_BASE', 'PEREIRA', 195000),
('TAT_BASE', 'DOSQUEBRADAS', 195000),
('TAT_BASE', 'MANIZALES', 191000),
('TAT_BASE', 'SANTA ROSA DE C', 210000),
('TAT_BASE', 'LA VIRGINIA', 226000),
('TAT_BASE', 'BELEN DE UMBRIA', 318000),
('TAT_BASE', 'MISTRATO-VITERBO', 435000),
('TAT_BASE', 'VITERBO', 238000),
('TAT_BASE', 'BELALCAZAR-SAN JOSE', 290000),
('TAT_BASE', 'BELALCAZAR-SAN JOSE-VITERBO', 369000),
('TAT_BASE', 'MARSELLA', 226000),
('TAT_BASE', 'BALBOA-LA CELIA', 277000),
('TAT_BASE', 'SANTUARIO', 265000),
('TAT_BASE', 'APIA', 265000),
('TAT_BASE', 'SANTUARIO APIA', 350000),
('TAT_BASE', 'PUEBLO RICO', 316000),
('TAT_BASE', 'SANTA CECILIA', 395000),
('TAT_BASE', 'PUEBLO RICO-SANTA CECILIA', 435000),
('TAT_BASE', 'MANIZALES MM', 300000),
('TAT_BASE', 'MANIZALES DESDE PEREIRA', 300000),
('TAT_BASE', 'CHINCHINA', 250000),
('TAT_BASE', 'CHINCHINA CON CROSDOQUI', 302000),
('TAT_BASE', 'MANIZALES- LA PLATA- CHINCHINA', 400000),
('TAT_BASE', 'PALESTINA', 226000),
('TAT_BASE', 'ARAUCA', 260000),
('TAT_BASE', 'PALESTINA-ARAUCA', 270000),
('TAT_BASE', 'ARAUCA DESDE BODEGA', 377000),
('TAT_BASE', 'MANIZALES- ARAUCA- QUINCHIA', 437000),
('TAT_BASE', 'SUPIA', 490000),
('TAT_BASE', 'SUPIA-SAN LORENZO', 500000),
('TAT_BASE', 'RIOSUCIO', 417000),
('TAT_BASE', 'ANSERMA', 437000),
('TAT_BASE', 'QUINCHIA-IRRA-41', 408000),
('TAT_BASE', 'PACORA-AGUADAS', 728000),
('TAT_BASE', 'SALAMINA-ARANZASU-NEIRA MM', 487000),
('TAT_BASE', 'MARMATO - LA MERCED-FILADELFIA', 474000),
('TAT_BASE', 'NEIRA', 321000),
('TAT_BASE', 'NEIRA- ARAUCA', 360000),
('TAT_BASE', 'GUATICA-RISARALDA', 437000),
('TAT_BASE', 'MANIZALES CROS', 191000),

-- PRECIOS_TAT_UNILEVER (NEGOCIACIONES)
('TAT_UNILEVER', 'NEGOCIACI√ìN MY1-8 MILLONES', 200000),
('TAT_UNILEVER', 'NEGOCIACION 8-15 MILLONES', 250000),
('TAT_UNILEVER', 'NEGOCIACION MY +15 MILLONES', 300000),

-- PRECIOS_TAT_FAMILIA (NEGOCIACIONES)
('TAT_FAMILIA', 'NEGOCIACI√ìN MYMY 1-4 MILLONES', 80000),
('TAT_FAMILIA', 'NEGOCIACI√ìN MY4-8 MILLONES', 120000),
('TAT_FAMILIA', 'NEGOCIACI√ìN MY8-12 MILLONES', 160000),
('TAT_FAMILIA', 'NEGOCIACI√ìN MYMY +12 MILLONES', 200000);
